# 🔄 AI 工作流规范 - 自动执行

> 这个文件定义了 AI 助手在这个项目中应该遵循的工作流。AI 助手应该自动检测并执行这些步骤，而无需用户提醒。

## 自动初始化流程（AI 自动执行）

### 阶段 1：工作空间检测（30秒）
AI 助手应该自动执行：
```bash
# 1. 检查 .ai/ 文件夹是否存在
ls -la .ai/

# 2. 检查 .WORKSPACE_CONFIG 文件
cat .ai/.WORKSPACE_CONFIG

# 3. 验证初始化状态
bash scripts/check-ai-init.sh
```

**预期输出**：
- ✓ .ai/ 文件夹存在
- ✓ 所有 5 个必需文件都在
- ✓ 初始化状态检查通过

### 阶段 2：规则学习（25分钟）
如果工作空间检测通过，自动按顺序阅读：

1. **MUST_READ_FIRST.md** (5分钟)
   - 理解强制规则
   - 记住规则 1-4

2. **PROJECT_OVERVIEW.md** (5分钟)
   - 理解项目结构
   - 记住关键文件位置

3. **IMPORTANT_NOTES.md** (8分钟)
   - 学习关键代码位置
   - 理解常见错误

4. **ISSUES_AND_SOLUTIONS.md** (7分钟)
   - 学习历史问题
   - 理解最佳实践

### 阶段 3：确认就绪（1分钟）
向用户报告初始化结果：
```
✅ 工作空间已初始化

已执行：
  ✓ 检测 .WORKSPACE_CONFIG
  ✓ 验证 .ai/ 系统完整性
  ✓ 阅读 4 个核心文档

核心理解：
  • 项目：Sonic PaperMod Hugo 主题
  • 规则：修改代码→更新 .ai/ 文档→同时提交
  • 禁止：只提交代码不提交文档

准备就绪，请说明任务。
```

### 阶段 4：工作执行
现在可以开始处理用户的实际请求

### 阶段 5：工作结束
在结束对话前，自动执行规则 4 的检查清单：

```bash
# 检查是否遗漏了什么
git status
git diff .ai/
```

报告：
```
对话总结：
  ✓ 代码修改：[列出]
  ✓ .ai/ 更新：[列出]
  ✓ Git 提交：[列出]
  ✓ 规则遵守：完全

准备继续或结束对话。
```

## 自动触发条件

AI 助手应该在以下情况自动执行初始化：

### ✅ 应该初始化
- 第一次处理这个项目（新对话）
- 无法找到 `.ai/.WORKSPACE_CONFIG` 文件
- `.ai/` 文件夹不完整
- 用户要求修改代码

### ❌ 不需要初始化
- 纯粹的问题解答（不涉及代码修改）
- 读取文档或文件
- 简单的信息查询
- 上一个对话已经初始化过

## 为什么这样设计？

| 目标 | 实现方式 |
|---|---------|
| 无需用户提醒 | AI 自动检测 .WORKSPACE_CONFIG |
| 规则自动应用 | 工作流内置规则执行 |
| 自然集成 | 初始化是工作流的一部分 |
| 防止遗漏 | 工作结束时自动检查 |

## AI 实现指南

### 如何判断项目有 AI 系统？
```bash
# 检查这个文件是否存在
test -f .ai/.WORKSPACE_CONFIG && echo "这个项目使用 AI 系统"
```

### 初始化失败怎么办？
如果 `.ai/` 系统检测失败：
1. 向用户报告问题
2. **停止工作**，不要猜测
3. 让用户修复问题后重新开始

示例：
```
❌ 工作空间检测失败

问题：.ai/ 文件夹不完整
  缺少：IMPORTANT_NOTES.md

无法继续工作。请用户：
1. 检查 .ai/ 文件夹
2. 重新克隆仓库或恢复文件
3. 运行 bash scripts/check-ai-init.sh
```

## 与规则的关系

这个工作流自动强制执行 `MUST_READ_FIRST.md` 中的规则：
| 规则 | 工作流阶段 |
|------|-----------|
| 规则 1：项目理解 | 阶段 2：规则学习 |
| 规则 2：代码修改与文档同步 | 阶段 4：工作执行 |
| 规则 3：提交信息规范 | 阶段 5：工作结束 |
| 规则 4：结束前检查清单 | 阶段 5：工作结束 |

---

**总结**：这个工作流让 AI 能够自动发现并执行项目约定，而无需每次都被提醒。
